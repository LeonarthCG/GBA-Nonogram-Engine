.thumb
push	{lr}
push	{r4-r7}

@draw cursor
ldr	r4,=#0x07000000
ldr	r1,=#0x4000
strh	r1,[r4,#2]
ldr	r1,=#0x0001
strh	r1,[r4,#4]
ldr	r5,=bgTilemapsBuffer
ldr	r5,[r5]

@find tile
tileFoundLoop:
ldrh	r0,[r5]
cmp	r0,#5
beq	tileFound
add	r5,#2
b	tileFoundLoop
tileFound:
mov	r6,#0x3F
and	r6,r5
lsl	r6,#2
sub	r6,#4
ldr	r1,=#0x4000
orr	r1,r6
strh	r1,[r4,#2]
mov	r6,r5
lsr	r6,#6
mov	r1,#0x3F
and	r6,r1
lsl	r6,#3
sub	r6,#4
ldr	r1,=#0
orr	r1,r6
strh	r1,[r4]
ldr	r7,=#0x02000160
ldrb	r0,[r7,#1]
lsl	r0,#3
ldrh	r2,[r4]
mov	r3,#0xFF
and	r2,r3
add	r0,r2
ldrh	r2,[r4]
ldr	r3,=#0xFF00
and	r2,r3
orr	r2,r0
strh	r2,[r4]
ldrb	r1,[r7]
lsl	r1,#3
ldrh	r2,[r4,#2]
ldr	r3,=#0x1FF
and	r2,r3
add	r1,r2
ldrh	r2,[r4,#2]
ldr	r3,=#0xFE00
and	r2,r3
orr	r2,r1
strh	r2,[r4,#2]
@move second cursor part
ldrh	r0,[r4,#8]
cmp	r0,#0
beq	drawsquare
mov	r0,#0
strh	r0,[r4,#8]
strh	r0,[r4,#10]
strh	r0,[r4,#12]
b	dontdrawsquare
drawsquare:
ldrh	r0,[r4]
strh	r0,[r4,#8]
ldrh	r0,[r4,#2]
strh	r0,[r4,#10]
ldr	r0,=#0x0005
strh	r0,[r4,#12]
dontdrawsquare:
@move the bars
mov	r2,#0x10
ldrh	r5,[r4]
mov	r1,#0xFF
and	r5,r1
ldr	r1,=#0x4000
orr	r5,r1
strh	r5,[r4,r2]
add	r2,#2
ldr	r6,=#0xC000
strh	r6,[r4,r2]
add	r2,#2
ldr	r7,=#0x0020
strh	r7,[r4,r2]
add	r2,#4
strh	r5,[r4,r2]
add	r2,#2
add	r6,#64
strh	r6,[r4,r2]
add	r2,#2
strh	r7,[r4,r2]
add	r2,#4
strh	r5,[r4,r2]
add	r2,#2
add	r6,#64
strh	r6,[r4,r2]
add	r2,#2
strh	r7,[r4,r2]
add	r2,#4
strh	r5,[r4,r2]
add	r2,#2
add	r6,#64
strh	r6,[r4,r2]
add	r2,#2
strh	r7,[r4,r2]
add	r2,#4
mov	r2,#0x30
ldr	r5,=#0x8000
strh	r5,[r4,r2]
add	r2,#2
ldrh	r6,[r4,#2]
ldr	r1,=#0x1FF
and	r6,r1
ldr	r1,=#0xC000
orr	r6,r1
strh	r6,[r4,r2]
add	r2,#2
ldr	r7,=#0x0040
strh	r7,[r4,r2]
add	r2,#4
add	r5,#64
strh	r5,[r4,r2]
add	r2,#2
strh	r6,[r4,r2]
add	r2,#2
strh	r7,[r4,r2]
add	r2,#4
add	r5,#64
strh	r5,[r4,r2]
add	r2,#2
strh	r6,[r4,r2]
add	r2,#2
strh	r7,[r4,r2]
add	r2,#4
add	r5,#64
strh	r5,[r4,r2]
add	r2,#2
strh	r6,[r4,r2]
add	r2,#2
strh	r7,[r4,r2]
add	r2,#4

End:
pop	{r4-r7}
pop	{r0}
bx	r0
